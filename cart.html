<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart page</title>
     <!-- bootstrap link  -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css"
  integrity="sha384-+qdLaIRZfNu4cVPK/PxJJEy0B0f3Ugv8i482AKY7gwXwhaCroABd086ybrVKTa0q" crossorigin="anonymous" />

<!-- google font link -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

<!-- font awesome link -->
<script src="https://kit.fontawesome.com/5b6d880526.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style/nav.css">
    <style>
        #count-item{
            height: 100px;
            font-size: 25px;
            border-bottom: 1px solid grey;
            padding: 2%;
        }
        #cart_page{
            display: grid;
            grid-template-columns: 60% 30%;
            justify-content: space-around;
            /* border: 1px solid black; */
            /* height: 700px; */
            padding: 5%;
        }
        /* #cart_item{
             
            border: 1px solid red;
        } */
        #cart_item>div{
            display: grid;
            /* margin: 20px auto; */
            border-bottom: 2px solid rgb(154, 156, 154);
            margin-bottom: 20px;
            /* flex-direction: row; */
            grid-template-columns: 40% 30% 20%;
            align-items: center;
            justify-content: space-between;
            padding: 2%;
            background-color: rgb(235, 230, 230);
        }
        #cart_total{
            height: 500px;
            border-radius: 30px;
            border: 1px solid grey;
            padding: 5%;
            font-size: 25px;
            background-color: rgb(235, 230, 230);
        }
        #cartp{
           
            display: flex;
            justify-content: space-between;
            padding: 5%;
            
        }
        #cartcontinue{
            width: 100%;
            height: 40px;
            background-color: red;
            border: none;
            color: white;
            margin: auto;
            text-align: center;
            font-size: 20px;
            border-radius: 20px;
        }
        #divfooter4{
            text-align: center;
        }
    </style>
</head>
<body>
  <div id="topnav">
    <div id="nav">
      <div id="left">
        <div>
          <h4><a class="atext" href="index.html">iHerb</a></h4>
        </div>
        <div>
          <h5>Shop</h5>
        </div>
        <div>
          <h5>Brand</h5>
        </div>
        <div>
          <h5>Help With</h5>
        </div>
        <div id="newbtn"><button>New</button></div>
      </div>
      <div id="middle"></div>
      <div id="right" class="d-flex justify-content-between gap-3 align-items-center">
        <div id="travelpage">
          <ul class=" dropdown">
            <li>
              <a class="dropdown-toggle text-white" href="#" id="accountDropdown" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                Account/Rewards
              </a>
              <ul class="dropdown-menu" aria-labelledby="accountDropdown">
                <li><a style="text-align: left;" class="dropdown-item" href="signup.html">SignUp</a></li>
                <li><a style="text-align: left;" class="dropdown-item" href="signin.html">SignIn</a></li>
              </ul>
            </li>
          </ul>
        </div>
        <div id="cartDiv">
          <a href="cart.html" class="atext" id="cartLink"><span class="material-icons"> shopping_cart </span></a>
        </div>
      </div>
    </div>
  </div>
       <div id="count-item">
           
       </div>
    <div id="cart_page">
        <div id="cart_item">

        </div>
        <div id="cart_total">
            <p>Order Summary</p>
              <h3 id="grand-total"></h3>
              <h3 id="discount"></h3>
              <h3 id="total-total"></h3>
              <h3 id="tax"></h3>
              <h3 id="final"></h3>

              <button id="cartcontinue" onclick="window.location.href='payment.html'">Proceed to checkout</button>
             
        </div>
    </div>
    <div id="divfooter4">
        <div class="footbig"> 
            <div id="footbottom">
              <p>
                iHerb.com © Copyright 1997-2022 iHerb, LLC. All rights reserved. iHerb®
                is a registered trademark of iHerb, LLC. Trusted Brands. Healthy
                Rewards. and the iHerb.com Trusted Brands. Healthy Rewards. Logo are
                trademarks of iHerb, LLC. *Disclaimer: Statements made, or products sold
                through this website, have not been evaluated by the United States Food
                and Drug Administration. They are not intended to diagnose, treat, cure
                or prevent any disease. Read more »
              </p>
              <p><a href="#">Privacy Policy </a> | <a href="#"> Terms of Use </a> | <a href="#"> Accessibility </a></p>
            </div>
        </div>
    </div>
</body>
</html>
<script>

      let cartArr= JSON.parse(localStorage.getItem("cartDetails"));
            // let No= cartArr.length 
            function abc(){
              
                let sum=0; 
                for(let i=0; i<cartArr.length; i++)
                {
                     sum+=cartArr[i]["qty"]
                }
                  let quant= document.getElementById("count-item").innerHTML= sum+ "  items in cart"
                  
            }
           
      function displayCart(cartArr){
        //   console.log(cartArr);
           cart_item.innerHTML=null;
             abc()
         
          cartArr.map(function(el,index,array){
              let div= document.createElement("div");
               
            //   here I am creating div for image and name only 
              let div_img= document.createElement("div")
              let image= document.createElement("img");
              image.src= el.img_url;

              let name= document.createElement("p");
              name.innerText= el.desc;
                
              let price= document.createElement("p");
              price.setAttribute("id","cartp")
              let price1= document.createElement("span")
              price.innerText= el.offer_price;
              let price2= document.createElement("span")
              price2.innerText= el.strike_price;
              price2.style.textDecoration="line-through" 
              price.append(price1,price2)
              div_img.append(image,name,price);
                  
            //   creating div for increasing and decresing count of a particular item
              let btndiv= document.createElement("div");

              let plus= document.createElement("button");
              plus.innerText="+";
              plus.addEventListener("click",function(){
                  increment(index);
              })
              let qtydisplay= document.createElement("span")
              qtydisplay.innerText= el.qty;
              let minus= document.createElement("button");
              minus.innerText="-";
              minus.addEventListener("click",function(){
                  decrement(index);
              })
              btndiv.append(plus,qtydisplay,minus);

            //   now need to create a div for removeing the item
            let btn= document.createElement("button")
            btn.textContent="Remove";
            btn.addEventListener("click",removecart)
            function removecart(){
                let p1= array.slice(0,index)
                let p2= array.slice(index+1,array.length);
                p1= p1.concat(p2);
                localStorage.removeItem("cartDetails");
                localStorage.setItem("cartDetails",JSON.stringify(p1))
                let displayCart= JSON.parse(localStorage.getItem("cartDetails"))
                console.log(displayCart)
                document.location.reload();
            }
            div.append(div_img,btndiv,btn)
            cart_item.append(div)

            
          })
      }
     
    

      function increment(index){
        abc()
         if( cartArr[index].qty<=20){
            cartArr[index].qty++;
            localStorage.setItem("cartDetails",JSON.stringify(cartArr))
           
         }
         showTotal()
        displayCart(cartArr)
      }
      function decrement(index){
        abc()
        if( cartArr[index].qty>1){
           cartArr[index].qty--;
           localStorage.setItem("cartDetails",JSON.stringify(cartArr))
        }
        showTotal()
       displayCart(cartArr)
     }
      
      function showTotal(){
          let grand= cartArr.reduce(function(acc,el){
              return acc+(el.strike_price*el.qty)
              return acc+(el.offer_price*el.qty)
          },0);
          let total= cartArr.reduce(function(acc,el){
             
              return acc+(el.offer_price*el.qty)
          },0);
          document.getElementById("grand-total").textContent =`ItemsTotal :   ${grand.toFixed(4)}`;
          document.getElementById("total-total").textContent =`SubTotal :   ${total.toFixed(4)}`;
          document.getElementById("discount").textContent=`Savings : -${(grand-total).toFixed(4)}`
          document.getElementById("tax").textContent=`Tax&Duties : ${((grand-total)*0.1).toFixed(4)}`
          document.getElementById("final").textContent=`Total : ${(total+((grand-total)*0.1)).toFixed(4)}`
      }
      showTotal();
      displayCart(cartArr);
    

</script>